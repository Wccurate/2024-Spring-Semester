# 数据库原理

## 第五章 规范化设计

==上课强调：==函数依赖-》数据冗余 ， 操作异常 —〉 1NF，2NF。。。-》无损分解

规范化设计理论：数据以来，范式，模式设计方法

$\begin{cases} 静态约束：数据依赖，主键和值域的设计\\动态约束：插入删除修改 \end{cases}$

==数据依赖==是起着核心作用

关系模式的一般形式：R<U,D,Dom,F> 

数据冗余，修改异常，插入异常，删除异常

关系$\subset$ 笛卡尔积

数据完整性约束：（1）值域完整性（DBMS完整性子系统实现）（2）依赖于属性见的曲直想等与否（数据依赖）

X函数确定Y/Y函数依赖X/X->Y<=>Y一对多X

完全函数依赖：X中的任何真子集都不能函数确定Y，==左部不可约依赖==

传递函数依赖：X->Y,Y->Z且$X \nsubseteq Y \& \not Y->X $

候选键：如果U完全函数依赖于K在R上成立，说明K是R的一个候选键

超键：如果在R上U函数完全依赖于X，X属于K那么X为超键

主属性：超键中的属性为主属性
==不在函数依赖的右部出现的属性一定出现在候选键中==

==*只在*函数依赖右侧出现的属性一定不是主属性==

关系模式：

+ 第一范式（1NF）：关系模式R的每个关系r的属性之都是不可分的原子值，那么R是第一范式（==规范化的关系==）
+ 第二范式（2NF）：是第一范式，并且R中每个非主属性都完全函数依赖于R的候选键
+ 第三范式（3NF）：如果关系模式R是第一范式，并且R中每个非主属性都不传递依赖于R的候选键
+ BCNF范式：是第一范式，并且每个属性都不传递依赖于R的候选键
  + 非主属性对候选键完全依赖
  + 主属性对不包含他的候选键也是完全函数依赖
  + 没有属性完全依赖非候选键的任何属性组

逻辑蕴含：可以从函数依赖集F中推导出的蕴含关系$F \models X \rightarrow Y$​

F所有的==逻辑蕴含==组成的集合称为F的闭包

FD的推理规则：（1）自反性 （2）增广性 （3）传递性 （4）并规则：$X \rightarrow Y~X\rightarrow Z~ X \to YZ$ (5) 伪传递规则$X->Y~YW->Z ~ XW->Z$（6）分解规则：$X->Y~Z \subseteq Y ~X->Z$ (7)复合规则：$X->Y,W->Z,XW->YZ$ （8）通用一致性定理：$X->Y,W->Z,X \cup (W-Y)->YZ$

平凡的FD：不是从自反性推出的FD

==只有非平凡的FD与完整性约束条件有关==

属性集闭包：属性集X的闭包用$X_{F}^{+}$表示

$X->Y$的充要条 件是$Y \subseteq X_{F}^{+}$

函数依赖集的等价和最小依赖集：如果两个函数依赖集的属性集闭包是相等的，那么这两个函数依赖集是等价的称为==G覆盖F== 或者==F覆盖G==，充要条件是F和G都在对方的闭包中

最小函数依赖集：（1）函数依赖右侧都是单属性（2）左端没有冗余属性：不存在部分以来于左属性的情况（3）没有冗余的函数依赖，删掉一个函数依赖之后和原来不等价

任何一个函数依赖集F都存在一个最小的函数依赖集$F_{min}$

关系模式的分解：数据等价和依赖等价

数据等价：表示相同的信息和内容，使用==无损连接==来衡量

依赖等价：两个数据库模式有相通的依赖集闭包

关系模式的分解原则：表达性，分离性，最小冗余性

## 第七章 数据库设计

==上课强调==：规划-〉需求分析（数据字典，数据流）-》概念设计-〉逻辑设计-》物理分析

确定最优数据模型和逻辑设计

生命周期：规划，需求分析，设计，程序编制，调试阶段，运行维护阶段

数据库应用系统：数据库系统的设计和实现，软件的设计和实现

数据库设计输入：总体信息需求，处理需求，DBMS特征，OS和硬件特征

数据库系统软件生命周期：规划，需求分析（数据流图，数据字典），概念设计（ER图），逻辑设计（转关系模型），物理设计，实现和运行维护

规划：可行性分析报告，数据库规划纲要

需求分析：输出需求说明书包括数据流程和数据字典

需求分析：全面详细的调查，确定用户的需求，用户活动图，系统范围图，数据流图，数据字典，输入总体信息需求和处理需求，输出

需求分析的步骤：用户活动图，系统范围图，数据流图（四个基本元素：数据流，处理，文件，外部实体），分析系统数据产生数据字典（数据项，数据结构，数据流，数据存储），（加工过程？）

数据流图：自顶向下描绘（细化）

数据字典：是元数据的集合，包括数据项，数据结构，数据流，数据存储，处理过程

### 概念设计

==概念设计==是整个数据库设计的关键，独立于逻辑设计，独立于DBMS，对现实世界的抽象和概括

自顶向下，自底向上，逐步扩张，混合策略

三个步骤：数据抽象，局部概念模式，将局部概念设计综合成全局概念设计，评审

概念设计目的定义==抽象对象==的关键结构（抽象分：系统状态的抽象抽象对象，系统转换的抽象抽象运算）

数据抽象的方法：聚集，概括，数据抽象层次

ER图操作：实体类型的分割（垂直分割，水平分割），实体类型的合并，联系类型的分裂，联系类型的合并

合并的联系类型必须是定义在相同的实体类型组合中，否则是不合法的合并

采用ER方法的概念设计：设计局部ER模式（实体和联系），设计全局ER模式（消除冲突，属性冲突，结构冲突，命名冲突），全局ER模式的优化原则（合并冗余）

### 逻辑设计

逻辑设计的输入：独立于DBMS，处理需求，约束条件，DBMS特征

输出：DBMS可处理的模式和子模式，程序设计指南，物理设计指南

流程：ER导出初始数据库模式，规范化设计（级别，规范化处理），模式评价，模式修改

模式评价：功能和性能

### 物理设计

步骤：存储记录（类型，长度），确定数据存放的位置（记录聚簇），存取方法的设计（主键索引），完整性和安全性考虑，程序设计

### 数据库实现

简历数据库结构，装入数据调试，装入实际数据

规范化理论的作用：需求分析阶段（函数依赖的概念），概念设计阶段（规范化理论），ER2schema

### 数据库运行和维护

维护数据库的安全和完整，检测并且改善性能，扩充数据库功能，及时修改错误

## 第八章  数据库管理

==上课强调==：数据库恢复-〉事务（ACID）-》数据库并发（两种锁，活锁和死锁，可串行化）-〉数据库完整性（静态三种 动态一种）-》 数据安全

形成一个逻辑工作单元的数据库操作的汇集称为事务

SQL定义事务：==begin transaction==

SQL提交事务：==commit==

事务回滚：==rollback==

事务的ACID性质：==原子性==，==一致性==，==隔离性==，==持久性==

故障分类：==事务故障==，==系统故障==，==介质故障==

简历冗余数据实施数据库的恢复（转存和登陆日志文件）

日志文件：

+ 事务开始记录：==<Ti,START>==
+ 更新数据记录：==<Ti,X,A,V1,V2>==
+ 事务终止记录：==Ti,COMMIT==
+ 日志严格按照时间顺序，先写日志再写数据库

事务故障：反向扫描日志文件，进行逆操作（==系统完成==）

系统故障：撤销未完成事务（只有START），重做已完成事务（有START和COMMIT）

介质故障：全部重做

检测点：定是检查点

日志记录优先原则，写入全部日志文件之后才能COMMIT

原子性：事务要么全部执行要么什么也不做，==数据库本身的职责，由DBMS的事务子系统决定==

一致性：数据库不会因为事务的执行而遭受破坏，==程序员的职责，DBMS完整性事务子系统测试==

隔离性：多个事务前后完成的结果一样，==DBMS并发控制子系统实现==

持久性：事务完成对数据库的更新应该反映在数据库中，==DBMS回复管理子系统==

并发操作带来的数据不一致包括：丢失数据，不一致分析，读脏数据

更新丢失：后更新覆盖了前更新

不一致分析（不可重复读取）：Ti读取数据，Tj修改数据，T i无法获得之前的数据

读脏数据：回滚的数据不一致性

三种不一致主要是因为并发行破坏了事务的隔离性，让==DBMS并发控制子系统完成==

+ 协调并发事务的执行
+ 保证数据库的完整性
+ 避免用户得到不正确的数据

并发调度的可串型化（封锁方法，时标方法，乐观方法）

可串型性是并发事务正确性的==唯一准则==

封锁：对数据对象进行加锁处理，释放锁之前其他事务不能更新此对象

$两种锁 \begin{cases} 排他锁exclusive lock（简称X锁） \\ 共享锁shared lock（简称S锁）\end{cases}$​

排他锁：要等锁解除之后再访问

共享锁：上S锁后允许其他事务继续加S锁，S锁全部解除之后不允许其他事务继续加X锁

封锁对象的大小称为封锁的粒度（Range：从最小的数据项-》整张表等）

粒度越大，可封锁对象越少，并发度越小，系统开销越少（==权衡系统开销和并发度==）

+ 少量元组任务：lock tuple
+ 大量元组任务：lock table（relation）
+ 大量多关系任务：lock database

PX协议和PXC协议（X锁）

PX Protocol：事务更新R之前需要==XFIND R==来获得R的X锁

PXC Protocol：释放锁和==COMMIT==以及==ROLLBACK==联系

PS协议和PSC协议（S锁）

PS Protocol：事务更新R之前需要==SFIND R==获得S锁，更新R必须要==UPDX R==操作把S锁升级成X锁

PSC Protocol：S锁的释放应该合并到==COMMIT==和==ROLLBACK==中

活锁（都处于等待加锁）死锁（锁都无法解除）

使用==先来先服务==避免活锁

死锁：事务依赖图如果有循环，那么就产生死锁，撤销某个事务解除死锁

两段锁协议：（1）读写任何操作之前都需要对该数据进行封锁（2）释放一个锁之后，事务不在获得其他任何封锁（==扩展，收缩两阶段==）

事务都遵循两段锁那么并行调度是可串型化的（==充分条件==）

两段锁协议会增加死锁的机会和风险

数据库中完整性：正确性，有效性，相容性

$完整性规则=\begin{cases}组成：触发条件，约束条件，出错处理 \\ 分类\begin{cases}域完整性约束\begin{cases} 域约束子句\\非空值约束 \\属性检查子句 \end{cases} \\ 基本表约束 \begin{cases} 主键约束\\外键约束 \\i余元组的检查子句（全局约束） \end{cases} \\ 断言\end{cases} \end{cases}$

SQL Server使用声明数据完整性（系统本身）和过程数据完整性（Trigger）两种方式实现数据完整性控制

数据完整性：约束，缺省，规则和触发器

过程数据完整性：触发器和存储过程

数据库安全性：保护数据库，防止不合法使用，以免数据的泄密，更改或破坏

低到高五个级别：环境，职员，OS，网络，DBS

数据库安全方法：用户标识和鉴定，存取控制（定义用户权限，查找用户权限，类别：自主存取控制（grant，revoke），强制存取控制）

sql安全机制：视图机制（数据安全性，逻辑独立性，操作简便性，create name（attribution） as select），授权子系统

## 第九章 分布式数据库

==上课强调==：物理上分散，逻辑上集中，-〉数据分片，数据分配

分布式数据库包括：局部数据库和全局数据库两个概念

分布式数据库的逻辑整体性特点:

+ 局部数据库是从各个场地的角度
+ 全局数据库是从整个系统的角度

DDBS：是物理上分散，逻辑上集中的数据库系统

DDB：是计算机网络环境中各场地上数据库的逻辑集合

DDBMS：是DDBS中的一组软件，负责管理分布环境下逻辑继承数据的存取，一致性和完整性

DDMS的基本特点：物理分散性，逻辑整体性，场地自治性，场地之间的协作性

其他特点：数据独立性（逻辑独立性，物理独立性，数据分布透明性），集终于自治相结合的控制机制（局部共享，全局共享，集中和自治），适当增加数据冗余度，事务管理的分布性

DDBMS的优点；灵活，适应分布式管理和控制，经济性，可靠性，局部应用相应快，扩展性

缺点：通信开销大，复杂存取结构，数据安全性和保密性差



DDBMS分类：同构同质，同构异质，异构型

数据存储：先分数据片，在数据分配

水平分片：

垂直分片：

导出分片：

混合分片：

分片时三个原则：完备性条件，可重构条件，不相交条件（水平分片互不重叠，垂直分片只有主键重叠）

数据分配：集中式，分割式，全复制式，混合式

评估因素：存储代价，可靠性，检索代价，更新代价

集中式数据库模式结构：三级模式结构，两级映像，两级独立性

分布式数据库：六层（上四级增加，下2级原有），全局外部级，全局概念级，分片级，分配级，局部概念级，局部内部集，局部数据库

六层模式，5层映像：0层和最后一层映像实现了集中式数据库的逻辑数据独立性和物理独立性，剩下几级映像共同组成了分布透明性

DDBMS功能：接受用户访问，访问网络字典，分布式处理，通信接口功能，数据和移植支持

DDBMS包括以下四个基本功能模块：查询处理模块，完整性处理模块，调度处理模块，可靠性处理模块

基于连接的优化策略：同一场地（嵌套循环发，排序扫描法），不同场地（整体传输，按需传输）

## 第十章 对象关系数据库

平面关系模型（只有基本数据类型），嵌套关系模型（有嵌套），复合对象模型（还可以有元组），面向对象类型（递归，指针）

面向对象的数据类型：基本数据类型，复合类型，引用类型，

# 强调题目

分布式数据库中分片的条件不是本关系属性的条件，而是其他关系属性的条件，这种分片属于导出分片

水平分片：和原本的关系属性有关	导出分片：两张表，根据第二站表的结果决定第一张表无法分片

两个事务T1T2，不能重复度

4个事务的并行调度最多可能有多少种不同的运行结果：4！

关系模式R（ABCDE）分解为R1（ABC）和R2（ADE），如果下列函数依赖f成立：A-》BC，CD-〉

E，B-》D，E-〉A，问：

（1）R的候选码：

A，E，BC，CD

（2）证明无损分解

画一个表

|              | A    | B    | C    | D    | E    |
| ------------ | ---- | ---- | ---- | ---- | ---- |
| ABC(分解1R1) |      |      |      |      |      |
| ADE(分解2R2) |      |      |      |      |      |

（3）求函数依赖f在R1和R2上的投影，证明该分解不保持函数依赖

R1:A—》BC

R2:E-〉A

R1和R2拓展的closure不包括B-》D

全局关系R的粉片和分配情况：R划分成四个逻辑片段，R1，R2，R3，R4，并以冗余的方式讲这些i安段分撇到王哥的三个地面上（画相容矩阵，两种锁，X排他锁，S共享锁）

![image-20240525211826917](/Users/wangshibo/Library/Application Support/typora-user-images/image-20240525211826917.png)